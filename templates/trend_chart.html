{% extends 'base.html' %}
{% block content %}
<div class="row">
    <div class="col-11">
        <div class="card">
            <div class="card-header">
                <h3>{{ tablename }}
                </h3>
            </div>
            <div class="card-body"><canvas id="myChart" width="100%"></canvas></div>
        </div>
    </div>
</div>
{% endblock content %}
{% block jscontent %}
{% if tablename == 'Total Income' %}
<script>
function getRandomColor() { //generates random colours and puts them in string
    for (var i = 0; i < 3; i++) {
        var letters = '0123456789ABCDEF'.split('');
        var color = '#';
        for (var x = 0; x < 6; x++) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }

}

var output = JSON.parse('{{ output | tojson | safe }}')
var ds = []
const labels = []

const hlabels = [];
for (n = 0; n < output.length; n++) {
    var hotelname = output[n]['hotel'];
    var date = output[n]['date']
    if (hlabels.indexOf(hotelname) == -1) {
        hlabels.push(hotelname);
        ds.push({ label: hotelname });
    }
    if (labels.indexOf(date) == -1) {
        labels.push(date)
    }
}


function getDatePrice(hotelname) {
    var arr = [];
    for (m = 0; m < output.length; m++) {
        var thisel = output[m]['hotel']
        if (thisel == hotelname) {
            arr.push({ x: output[m]['date'], y: output[m]['finalprice'] });
        }
    }
    return arr;
}

for (hs = 0; hs < ds.length; hs++) {
    var bgcolor = getRandomColor();
    ds[hs]['data'] = getDatePrice(ds[hs]['label'])
    ds[hs]['backgroundColor'] = bgcolor;
    ds[hs]['borderColor'] = bgcolor;
}

const data = {
    labels: labels,
    datasets: ds
};

const config = {
    type: 'line',
    data: data,
    options: {
        scales: {
            x: {
                type: 'time',
                time: {
                    unit: 'day'
                }
            }
        }
    }

};

const myChart = new Chart(
    document.getElementById('myChart'),
    config
);
</script>
{% elif tablename == 'Due Per User' %}
<script>
var personval = $('#due_user').val();
console.log(personval);
var personName = $('[value="'+personval+'"]').attr('personName');
const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'];
const data = {
  labels: labels,
  datasets: [{
    label: 'Booking Due Per User by '+personName,
    data: [65, 59, 80, 81, 56, 55, 40],
    backgroundColor: [
      'rgba(255, 99, 132, 0.2)',
      'rgba(255, 159, 64, 0.2)',
      'rgba(255, 205, 86, 0.2)',
      'rgba(75, 192, 192, 0.2)',
      'rgba(54, 162, 235, 0.2)',
      'rgba(153, 102, 255, 0.2)',
      'rgba(201, 203, 207, 0.2)'
    ],
    borderColor: [
      'rgb(255, 99, 132)',
      'rgb(255, 159, 64)',
      'rgb(255, 205, 86)',
      'rgb(75, 192, 192)',
      'rgb(54, 162, 235)',
      'rgb(153, 102, 255)',
      'rgb(201, 203, 207)'
    ],
    borderWidth: 1
  }]
};

const config = {
    type: 'bar',
    data: data,
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    },
};
const myChart = new Chart(
    document.getElementById('myChart'),
    config
);
</script>
{% elif tablename == 'Due Per Hotel'%}
{% endif %}
{% endblock jscontent %}